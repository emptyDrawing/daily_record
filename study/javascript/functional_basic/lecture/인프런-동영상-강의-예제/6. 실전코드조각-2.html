<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>6. 실전코드조각-2</title>
  <script src="js/partial.js"></script>
  <script src="js/_.js"></script>
</head>
<body>

<script>

var products = [
  {
    is_selected: true, // <--- 장바구니에서 체크 박스 선택
    name: "반팔티",
    price: 10000, // <--- 기본 가격
    sizes: [ // <---- 장바구니에 담은 동일 상품의 사이즈 별 수량과 가격
      { name: "L", quantity: 4, price: 0 },
      { name: "XL", quantity: 2, price: 0 },
      { name: "2XL", quantity: 3, price: 2000 }, // <-- 옵션의 추가 가격
    ]
  },
  {
    is_selected: true,
    name: "후드티",
    price: 21000,
    sizes: [
      { name: "L", quantity: 2, price: -1000 },
      { name: "2XL", quantity: 4, price: 2000 },
    ]
  },
  {
    is_selected: false,
    name: "맨투맨",
    price: 16000,
    sizes: [
      { name: "L", quantity: 10, price: 0 }
    ]
  }
];

//1. 모든 수량
_.go(
  products,
  _.deep_pluck('sizes.quantity'),
  _.reduce((a,b) => a+b),
  console.log
)

var reduce_quantity = _.reduce( (tq, product) => _reduce( 
  product.sizes, (sum, size) => sum+ size.quantity  , tq) 
,0);

_.go(
  products,
  reduce_quantity,
  console.log
)


//2. 선택 된 총 수량
_.go(
  products,
  _.filter(_get('is_selected')),
  _.deep_pluck('sizes.quantity'),
  _.reduce((a,b) => a+b),
  console.log
)

_.go(
  products,
  _.filter(_get('is_selected')),
  reduce_quantity,
  console.log
)

//3. 모든 가격
var reduce_price = _.reduce( (tp, product) => 
  _reduce(
    product.sizes, 
    (sum, size) => sum + (size.quantity * (product.price + size.price)), 
    tp
  ) 
,0);

_.go(
  products,
  reduce_price,
  console.log
)


//4. 선택 된 총 가격
var seleted_check =   _.filter(_get('is_selected'));

_.go(
  products,
  seleted_check,
  reduce_price,
  console.log
)


</script>

</body>
</html>